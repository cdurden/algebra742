{% extends "CompleteTableQuestion.html" %}
{% from "macros.html" import question_container_selector with context%}
{% block head %}
{{ super() }}
<script>
var draggable;
var droppable;
var lastDropzoneTarget;
loadScript("https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.8/lib/draggable.bundle.js", function() {
    draggable = new Draggable.Draggable(document.querySelectorAll('{{- question_container_selector() -}}'), {
      sensors: [Draggable.Sensors.DragSensor],
      mirror: {
        constrainDimensions: true,
        cursorOffsetX: 0,
        cursorOffsetY: 0,
      },
      draggable: '.item'
    })
    .on('drag:start',  function(e) {
        console.log('drag:start');
        lastDropzoneTarget = null;
    })
    .on('drag:move',  function(e) {
        //console.log(e);
        console.log('drag:move');
        if (e.sensorEvent.target.classList.contains('dropzone')) {
            lastDropzoneTarget = e.sensorEvent.target;
        } else {
            lastDropzoneTarget = null;
        }
    })
    .on('drag:stop',  function(e) {
        console.log(e);
        console.log('drag:stop');
        if (lastDropzoneTarget != null) {
            payload = e.originalSource.getAttribute("data-payload");
            lastDropzoneTarget.setAttribute("value",payload);
        }
    });
    //sensor = new Draggable.Sensors.DragSensor(document.querySelectorAll('{{- question_container_selector() -}}'),{});
  /*
  .on('drag:start', () => console.log('drag:start'))
  .on('drag:move',  () => console.log('drag:move'))
  .on('drag:stop',  () => console.log('drag:stop'));
    droppable = new Draggable.Droppable(document.querySelectorAll('{{- question_container_selector() -}}'), {
  draggable: '.item',
  dropzone: '.dropzone'
});
    droppable.on('droppable:dropped', function(e) {
        console.log('droppable:dropped');
        console.log(e);
        //console.log(e.dragEvent.originalSource);
        console.log(e.dragEvent.originalSource.getAttribute("data-payload"));
        payload = e.dragEvent.originalSource.getAttribute("data-payload");
        e.dropzone.setAttribute("value",payload);
        e.cancel();
    });
    droppable.on('droppable:returned', () => console.log('droppable:returned'));
*/
    $('{{- question_container_selector() -}}').find('input').addClass('dropzone');
});
</script>
{% endblock %}
{% block body %}
{{ super() }}
<center>
<div class="container">
    {% for block in blocks %}
    <div class="dropzone draggable-dropzone--occupied"><div class="item" data-payload="{{ block }}">{{ block }}</div></div>
    {% endfor %}
</div>
</center>
{% endblock %}
